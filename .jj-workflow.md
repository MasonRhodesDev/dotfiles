# Jujutsu Two-Branch Workflow

## Branch Structure

- **personal-pc** - Personal machine (active working branch)
- **work-pc** - Work machine (active working branch)
- **main-archived** - Old merge point (backup only, not actively used)

## Daily Workflow

### Morning: Sync from Other Machine

```bash
# Fetch latest from GitHub
jj git fetch

# Check what changed on other machine
jj log -r work-pc

# Merge changes from work-pc into personal-pc
jj new personal-pc
jj rebase -d personal-pc -s work-pc

# Resolve conflicts if any (edit files, jj auto-resolves)
jj status  # Check for conflicts

# Describe the sync
jj describe -m "Sync changes from work-pc"
```

### During Day: Make Changes

```bash
# Edit configs normally
chezmoi edit ~/.config/hypr/hyprland.conf
# Or edit and add:
nvim ~/.config/hypr/hyprland.conf
chezmoi add ~/.config/hypr/hyprland.conf

# Chezmoi auto-commits via git (autoCommit=true)
# jj automatically imports git commits

# Verify changes
jj log -r @
```

### Evening: Push Changes

```bash
# Review your changes
jj log -r 'mine() & ::@'

# Push to GitHub
jj git push --bookmark personal-pc
```

## Conflict Resolution

jj shows conflicts with detailed markers:
```
<<<<<<< Conflict 1 of 1
%%%%%%% Changes from base to side #1
-old content
+your change from personal-pc
+++++++ Contents of side #2
their change from work-pc
>>>>>>> Conflict 1 of 1 ends
```

**Resolution strategy:**
- **Machine-specific files** (monitors.conf, rules.conf): Keep separate, don't merge
- **Shared configs** (binds.conf, hyprland.conf): Edit to include both changes
- **Template files**: Usually separated by `{{ if }}` conditionals, merge both

**Undo mistakes:**
```bash
jj op log     # View operation history
jj op undo    # Undo last operation
```

## Why Two Branches?

- **No merge bottleneck** - Eliminated main as forced merge point
- **Better conflicts** - jj's conflict markers are clearer than git's
- **Sync when ready** - Pull changes selectively, not forced
- **Simpler model** - "My branch" + "other machine's branch"
- **Safety net** - Operation log allows undoing mistakes

## Chezmoi Integration

Chezmoi continues using git commands (autoCommit=true, autoPush=true).
jj colocated mode automatically imports git commits - no configuration changes needed.

## Reference Documentation

See `.plans/knowledge-base/` for detailed guides:
- `jj-quickstart.md` - Command cheat sheet
- `jj-troubleshooting.md` - Problem solving
- `jj-workflow-guide.md` - Complete workflows

## Rollback Plan

If two-branch workflow doesn't work:
```bash
git checkout main-archived
git branch -f main
git push origin main -f
git checkout personal-pc
```

main-archived bookmark preserved as safety backup.
