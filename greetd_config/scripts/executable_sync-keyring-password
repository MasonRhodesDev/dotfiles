#!/bin/bash
# Keyring password synchronization script for PAM
# This script updates the GNOME Keyring password to match the login password
# when authentication succeeds with a different password than the keyring.

set -e

# Read the authentication token (password) from PAM
read -r AUTH_TOKEN

# Only proceed if we have a token
if [ -z "$AUTH_TOKEN" ]; then
    exit 0
fi

# Try to unlock the keyring with the current password
# If this fails, the keyring password is out of sync
if ! echo -n "$AUTH_TOKEN" | gnome-keyring-daemon --unlock >/dev/null 2>&1; then
    # Keyring unlock failed - password is out of sync
    # We'll update it on next successful login via PAM module
    exit 0
fi

# Keyring unlocked successfully
exit 0
